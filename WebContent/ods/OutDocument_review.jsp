<%@ include file="../admin/configHead.jsp"%>
<%@ page		
	info= "사외공문 보기"		
	contentType = "text/html; charset=KSC5601" 		
	import="java.io.*"
	import="java.util.*"
	import="com.anbtech.text.*"
	import="com.anbtech.dms.entity.*"
	import="com.anbtech.date.anbDate"
	import="com.anbtech.file.textFileReader"
%>
<%
	//-----------------------------------
	//초기화 선언
	//-----------------------------------
	com.anbtech.dms.entity.OfficialDocumentTable table;						//helper 
	com.anbtech.date.anbDate anbdt = new anbDate();							//날자
	textFileReader text = new com.anbtech.file.textFileReader();			//본문파일 읽기
	
	//-----------------------------------
	// 변수선언
	//-----------------------------------
	String user_name="";			//기안자 이름
	String doc_id="";				//문서번호
	String slogan="";				//슬로건
	String title_name="";			//부서 Title명
	String in_date="";				//기안일자		
	String receive="";				//수신
	String reference="";			//참조
	String sending="";				//발신
	String subject="";				//제목
	String address="";				//발신자 주소
	String tel="";					//전화번호
	String fax="";					//팩스번호
	String bon_path="";				//본문저장 확장path
	String bon_file="";				//본문저장 파일명
	String read_con="";				//본문내용
	String firm_name="";			//발신부서명
	String representative="";		//발신부서 대표명	
	String fname="";				//공통:파일원래명	
	String sname="";				//공통:파일저장명		
	String ftype="";				//공통:파일확장자명	
	String fsize="";				//공통:파일크기
	String[][] addFile;				//첨부관련내용 담기
	String module_name="";			//보낼모듈종류
	String module_add="";			//보낼부서 주소
	String mail="";					//전자우편종류
	String mail_add="";				//전자우편주소(사번/이름;)
	
	//-----------------------------------
	//	공문공지 내용 읽기
	//-----------------------------------
	ArrayList table_list = new ArrayList();
	table_list = (ArrayList)request.getAttribute("Data_One");
	table = new OfficialDocumentTable();
	Iterator table_iter = table_list.iterator();
	
	if(table_iter.hasNext()){
		table = (OfficialDocumentTable)table_iter.next();

		user_name=table.getUserName();				//기안자 이름
		doc_id=table.getDocId(); 
			if(doc_id == null) doc_id = "";			//문서번호
		slogan=table.getSlogan();					//슬로건
		title_name=table.getTitleName();			//부서 Title명
		in_date=table.getInDate();					//기안일자
			in_date = in_date.substring(0,10);
		receive=table.getReceive();;				//수신
		reference=table.getReference();				//참조
			if(reference == null) reference = "";
		sending=table.getSending();					//발신
		subject=table.getSubject();					//제목
		address=table.getAddress();					//발신자 주소
		tel=table.getTel();							//전화번호
		fax=table.getFax();							//팩스번호
		bon_path=table.getBonPath();				//본문저장 확장path
		bon_file=table.getBonFile();				//본문저장 파일명
		firm_name=table.getFirmName();				//발신부서명
		representative=table.getRepresentative();	//발신부서 대표명	
		fname=table.getFname();						//공통:파일원래명	
		sname=table.getSname();						//공통:파일저장명		
		ftype=table.getFtype();						//공통:파일확장자명	
		fsize=table.getFsize();						//공통:파일크기
		module_name=table.getModuleName();			//보낼모듈종류
		module_add=table.getModuleAdd();			//보낼부서주소
		mail=table.getMail();						//전자우편종류
		mail_add=table.getMailAdd();				//전자우편주소(사번/이름;)
	}

	//본문파일읽기
	String full_path = upload_path + bon_path + "/bonmun/" + bon_file;
	read_con = text.getFileString(full_path);

	//첨부파일읽어 배열에 담기
	if(fname == null) fname = "";
	int cnt = 0;
	for(int i=0; i<fname.length(); i++) if(fname.charAt(i) == '|') cnt++;

	addFile = new String[cnt][4];
	for(int i=0; i<cnt; i++) for(int j=0; j<4; j++) addFile[i][j]="";

	if(fname.length() != 0) {
		StringTokenizer f = new StringTokenizer(fname,"|");		//파일명 담기
		int m = 0;
		while(f.hasMoreTokens()) {
			addFile[m][0] = f.nextToken();
			addFile[m][0] = addFile[m][0].trim(); 
			if(addFile[m][0] == null) addFile[m][0] = "";
			m++;
		}
		StringTokenizer t = new StringTokenizer(ftype,"|");		//파일type 담기
		m = 0;
		while(t.hasMoreTokens()) {
			addFile[m][1] = t.nextToken();
			addFile[m][1] = addFile[m][1].trim();
			if(addFile[m][1] == null) addFile[m][1] = "";
			m++;
		}
		StringTokenizer s = new StringTokenizer(fsize,"|");		//파일크기 담기
		m = 0;
		while(s.hasMoreTokens()) {
			addFile[m][2] = s.nextToken();
			addFile[m][2] = addFile[m][2].trim();
			if(addFile[m][2] == null) addFile[m][2] = "";
			m++;
		}
		StringTokenizer o = new StringTokenizer(sname,"|");		//저장파일 담기
		m = 0;
		int no = 1;
		while(o.hasMoreTokens()) {
			addFile[m][3] = o.nextToken();
			addFile[m][3] = addFile[m][3].trim() + ".bin";			
			if(addFile[m][3] == null) addFile[m][3] = "";
			m++;
			no++;
		}
	}	
%>

<html>
<head>
<meta http-equiv="Content-Language" content="euc-kr">
<title>사내공문</title>
<LINK href="../ods/css/style.css" rel=stylesheet>
</head>


<BODY leftmargin='0' topmargin='10' marginwidth='0' marginheight='0'>
<center>

<% //slogan, title_name 출력 
	int div_h = 75;
	out.println("<font size=2>&nbsp;"+slogan+"&nbsp;</font><br>");
	if(title_name.length() > 0) {
		out.println("<font size=6>&nbsp;"+title_name+"&nbsp;</font><br>");
	} else {
		out.println("<font size=6>&nbsp;&nbsp;</font><br>");
		div_h = 72;
	}
%>

<table width='640' border="0" cellspacing="0" cellpadding="0">
	<tr><td width=50% align='left' height=20><img src='../ods/images/logo.jpg' align='absmiddle' border='0'></td>
		<td width=50% align='right'><div id="print" style="position:relative;visibility:visible;">
			<a href='Javascript:winprint();'><img src='../ods/images/bt_print.gif' align='absmiddle' border='0'></a> <!-- 출력 -->
			<a href='Javascript:self.close();'><img src='../ods/images/bt_close.gif' align='absmiddle' border='0'></a> <!-- 닫기 -->
		</div></td>
	</tr>
</table>

<table width='640' border='0' cellspacing='0' cellpadding='0'>
	<tr><td width=100% height="2"></td></tr>
	<TR><TD width=100% height='2' bgcolor='#9CA9BA'></TD></TR>
	<tr><td width=100% height="5"></td></tr>
</table>
	
<table width='640' border='0' cellspacing='0' cellpadding='0' style="border-collapse: collapse" bordercolor="#9CA9BA"> 
	<tr>
		<td width="90" height="20" align="center" valign="middle">문서번호 :</td>
		<td width="230" height="20" align="left" valign="middle"><%=doc_id%></td>
		<td width="90" height="20" align="center" valign="middle">
			일&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;자 :</td>
		<td width="230" height="20" align="left" valign="middle"><%=in_date%></td>
	</tr>
	<tr>
		<td width="90" height="20" align="center" valign="middle">
			수&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;신 :</td>
		<td width="230" height="20" align="left" valign="middle"><%=receive%></td>
		<td width="90" height="20" align="center" valign="middle">기 안 자 : </td>
		<td width="230" height="20" align="left" valign="middle"><%=user_name%></td>
	</tr>
	<tr>
		<td width="90" height="20" align="center" valign="middle">
			참&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;조 :</td>
		<td width="550" height="20" align="left" valign="middle" colspan=3><%=reference%></td>
	</tr>
</table>

<table width='640' border='0' cellspacing='0' cellpadding='0' style="border-collapse: collapse" bordercolor="#111111">
	<tr>
		<td width="100%" height="10" align="left" valign="middle" colspan=2></td>
	</tr>
	<tr>
		<td width="90" height="30" align="center" valign="middle">
			<font size=3><b>제&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;목 :</b></font></td>
		<td width="550" height="30" align="left" valign="middle">
			<font size=3><b><%=subject%></b></font></td>
	</tr>
	<tr><td width=100% height="2" bgcolor='#9CA9BA' colspan=2></td></tr>
</table>

<table width='640' border='0' cellspacing='0' cellpadding='0' style="border-collapse: collapse" bordercolor="#111111">
	<tr>
		<td width="640" height="10" align="left" valign="top"></td>
	</tr>
	<tr>
		<td width="640" height="360" align="left" valign="top">
		<textarea rows=40 cols=88 style="border:1px solid #787878;" readonly><%=read_con%></textarea></td>
	</tr>
	<tr>
		<td width="100%" height="10" align="left" valign="middle" colspan=2></td>
	</tr>
</table>

<table width='640' border='0' cellspacing='0' cellpadding='0' style="border-collapse: collapse" bordercolor="#111111">
	<tr>
		<td width="90" height="60" align="center" valign="middle">첨부파일 : </td>
		<td width="550" height="60" align="left" valign="middle">
		<%
		for(int i=0; i<cnt; i++) {
			out.println("&nbsp;<a href='../ods/attach_download.jsp?fname="+addFile[i][0]+"&ftype="+addFile[i][1]+"&fsize="+addFile[i][2]+"&sname="+addFile[i][3]+"&extend="+bon_path+"'>"+addFile[i][0]+"</a><br>");
		} 
		%>
		</td>
	</tr>
</table>

<font size=6><b><%=firm_name%></b></font><br>
<font size=6><b><%=representative%></b></font>

</center>
</body>
</html>

<script language=javascript>
<!--
//출력하기
function winprint()
{
	document.all['print'].style.visibility="hidden";
	window.print();
	document.all['print'].style.visibility="visible";
}
-->
</script>
